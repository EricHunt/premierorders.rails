<% content_for :head do %>
  <script type="text/javascript">
    jQuery(function($) {
      ajax_date($(".job_date").hover(editIn, editOut));
      $(".job_status").change(post_this_update);
    });
  </script>
<% end %>

<h2>Job List</h2>
<p id="notice"><%= notice %></p>

<table>
  <tr>
    <th>Job Name</th>
    <th>Job Number</th>
    <th>Upload Date</th>
    <th>Due Date</th>
    <th>Ship Date</th>
    <th>Status</th>
    <th>Special Instructions</th>
    <th>Franchise Name</th>
    <th>Credit Status</th>
    <th colspan="3">Actions</th>
  </tr>
  <% @jobs.each do |job| %>
    <tr>
      <td><%= link_to job.name, job %></td>
      <td><%= job.job_number %></td>
      <td><%= job.created_at %></td>
      <% if can? :admin_job, job %>
        <td><span class="job_date" id="job[<%=job.id%>][due_date]"><%= job.due_date %></span></td>
        <td><span class="job_date" id="job[<%=job.id%>][ship_date]"><%= job.ship_date %></span></td>
        <td><%= select_tag("job[#{job.id}][status]", options_for_select(Job::STATUS_OPTIONS, job.status), :class => 'job_status') -%></td>
      <% else %>
        <td><%= job.due_date %></td>
        <td><%= job.ship_date %></td>
        <td><%= job.status %></td>
      <% end %>
      <td><%= job.comment %></td>
      <td><%= job.franchisee.franchise_name %></td>
      <td><span style="color: <%= job.franchisee.credit_status %>"><%= job.franchisee.credit_status %></span></td>
      <td><%= link_to 'Cutrite', cutrite_job_path(job) %></td>
      <td><%= link_to 'Edit', edit_job_path(job) %></td>
      <td>
        <% if can? :admin_job, job %><%= link_to 'Delete', job, :confirm => 'Are you sure?', :method => :delete %><% end %>
      </td>
    </tr>
  <% end %>
</table>

<%= will_paginate @jobs unless @jobs.empty? %>

<% content_for :local_nav do %>
  <%= link_to 'New Job', new_job_path %>
<% end %>
